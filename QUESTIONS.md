# MCP サーバー要件確認のための質問

本プロジェクトで実装する Common Lisp 製 MCP (Model Context Protocol) サーバーの要件定義にあたり、以下の点についてご回答ください。回答に基づき最小実装スコープとロードマップを確定します。

## 1. プロジェクトの目的・成功条件
- 想定クライアント（例: 各種 MCP 対応 IDE/エージェント、独自クライアント）は何ですか？
- サーバーが提供すべき中核価値は何ですか（例: ツール実行、ドキュメント提供、プロンプト提供、社内 API 連携など）？
- MVP の完了定義（具体的なデモ・ユースケース・測定可能な指標）は何ですか？

## 2. 対応する MCP 仕様範囲
- 対応すべき MCP 仕様のバージョンは？公式仕様の参照元 URL も提示可能でしょうか？
- 必須機能の優先度を教えてください（`tools` / `resources` / `prompts` / `models` 等）。
- JSON-RPC バージョンやハンドシェイク/初期化フローについて、準拠すべき既存実装はありますか？

## 3. トランスポートとプロセスモデル
- トランスポートはどれを採用しますか？（標準入出力/stdio、WebSocket、HTTP/2 等）
- サーバー起動形態は単一長寿命プロセス、オンデマンド起動、またはフォーク/ワーカー方式のどれを想定しますか？
- 同時実行モデルはスレッド、イベントループ、あるいは混在のどれを希望しますか？最大同時実行数の目安は？

## 4. 対応プラットフォーム・処理系
- 対応 OS/アーキテクチャ（例: Linux x86_64 を必須、macOS 任意 など）を指定してください。
- 対応する Common Lisp 処理系（SBCL/ECL/CCL/CLISP など）と最小バージョンは？優先度の高い処理系は？
- 依存管理は Quicklisp を前提としますか？社内ミラーやバージョンピン留めの要望はありますか？

## 5. セキュリティとサンドボックス
- `tools` で許可する操作の範囲は？（ファイル読み取り/書き込み、シェル実行、HTTP アクセス など）
- ファイルアクセスはどのディレクトリに限定しますか？デフォルトの deny/allow ポリシーは？
- 外部コマンド・ネットワークアクセスの制限（ホワイトリスト/ブラックリスト、タイムアウト、レート制限）は必要ですか？
- 認証/認可は必要ですか？（トークン、mTLS、環境変数ベースの共有シークレット など）

## 6. 提供機能の詳細
- `tools`: 具体的に必要なツールと各引数スキーマ、タイムアウト、出力サイズ上限、ストリーミング要否を教えてください。
- `resources`: 参照提供すべきドキュメントやナレッジの格納先（ローカル/リモート）、更新頻度、キャッシュ方針は？
- `prompts`: 提供したいテンプレートやバリアント管理方法、ローカライズ要否は？
- `models`/`sampling`: 外部推論 API を仲介しますか？その場合、対応プロバイダ、API キーの扱い、コスト制御の要件は？

## 7. エラーハンドリングと回復
- プロトコルレベルのエラー分類（ユーザー入力エラー、環境エラー、内部エラー）に関する方針は？
- キャンセル、タイムアウト、再試行の既定値と最大値は？
- ヘルスチェック/ハートビートや自己診断エンドポイントは必要ですか？

## 8. ロギング/メトリクス/トレース
- ログ出力形式（JSON/行ログ）、ログレベル、PII マスキング方針は？
- 収集したいメトリクス（QPS、レイテンシ、失敗率、メモリ使用量等）と出力先は？
- 分散トレースや相関 ID の要件は？

## 9. パフォーマンスと容量計画
- 目標レイテンシ（p50/p95）と同時処理数の想定は？
- メモリ/CPU の上限目安、ガーベジコレクションに関する制約やチューニングポリシーは？

## 10. テスト戦略と CI
- テストは Rove + ASDF `test-op` で実行します。CI（GitHub Actions 等）要件やサポート対象の処理系/OS マトリクスは？
- プロトコル互換性のための準拠テストやフィクスチャ（モッククライアント/サーバー）は必要ですか？

## 11. 配布・運用
- 配布形態（ソース、Quicklisp、バイナリ、Docker など）と運用環境の前提は？
- 設定方法（環境変数、設定ファイル、コマンドライン引数）の優先度は？ホットリロード要件はありますか？

## 12. ライセンスと公開範囲
- リポジトリのライセンス（MIT/BSD/Apache-2.0/プロプライエタリ等）は？
- 公開/非公開、将来の社外提供の可能性について方針は？

## 13. ドキュメント
- README に最低限含めたい内容（クイックスタート、サンプル、制限事項、セキュリティ注意点）を指定してください。
- API/ツールごとの使用例やエラーカタログの掲載は必要ですか？

## 14. スケジュールと優先順位
- MVP、Beta、GA の各マイルストーンと目標日付は？
- 最優先で届けたいユースケースはどれですか？

## 15. 非機能・禁止事項
- 使用禁止事項（例: ランタイム `eval`/動的インターニング、任意コード実行、外部送信）や法令/社内規定上の制約は？
- 監査ログの保持期間、データ保持・削除ポリシーに要件はありますか？

---
回答いただければ、要件を REQUIREMENTS.md とロードマップに落とし込み、TDD で最小実装から着手します。
